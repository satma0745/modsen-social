# Models


## Содержание

- [Миграции](#миграции)
- [Правила построения схемы](#правила-построения-схемы)


## Миграции

На данный момент миграции схемы не реализованы.
Варианты реализации, достойные рассмотрения:
 - самописные миграции (readme + .js script per migration)
 - migrate-mongo tool (autogen migration scripts)


## Правила построения схемы

Схема базы данных строится с учётом того, какие данные выбираются вместе.

 - [Коллекция `users`](#users)
 - [Коллекция `refresh tokens`](#refresh-tokens)

### Users

В данном случае довольно большое количество запросов требует того, что бы юзеры выбирались с профилем (из профиля 
берётся headline).
Поэтому профиль является частью схемы юзера.
Пока это позволительно с точки зрения производительности, хотелось бы пользоваться таким подходом, т.к. он удобен в 
использовании.
Однако стоит помнить, что в будущем может потребоваться разделение коллекции пользователей и профилей.

### Refresh tokens

Рефреш токены вынесены отдельно от пользователей, т.к. нет никакой выгоды от хранения их вместе.
К тому же, идентификатором документа является не id токена, а id пользователя, которому токены принадлежат.
Такое решение было принято в честь того, что большинство (если не все) операции над рефреш токенами завязаны на id 
пользователя (отзыв всех токенов пользователя, добавление нового токена).
Под исключение попадает разве что сама операция рефреша токена, когда нужно отозвать лишь 1 конкретный токен, однако,
даже в таком случае выбранный подход не на много затрудняет выполнение операции.